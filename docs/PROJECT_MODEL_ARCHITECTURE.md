# Project Model - Visual Structure

## ğŸ—ï¸ New Schema Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PROJECT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ _id: ObjectId                                                  â”‚
â”‚ â€¢ name: string                                                   â”‚
â”‚ â€¢ description?: string                                           â”‚
â”‚ â€¢ status: enum                                                   â”‚
â”‚ â€¢ priority: enum                                                 â”‚
â”‚ â€¢ startDate: Date                                                â”‚
â”‚ â€¢ endDate: Date                                                  â”‚
â”‚ â€¢ deadline?: Date                                                â”‚
â”‚ â€¢ progress: number (auto-calculated)                             â”‚
â”‚ â€¢ createdBy: ObjectId â†’ User                                     â”‚
â”‚ â€¢ createdAt: Date                                                â”‚
â”‚ â€¢ updatedAt: Date                                                â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ PRODUCTS ARRAY                                            â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ [                                                         â”‚   â”‚
â”‚ â”‚   {                                                       â”‚   â”‚
â”‚ â”‚     productId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚ â”‚     snapshot: {                   â”‚ (reference for       â”‚   â”‚
â”‚ â”‚       designNumber: string        â”‚  linking, but       â”‚   â”‚
â”‚ â”‚       productName: string         â”‚  snapshot is used   â”‚   â”‚
â”‚ â”‚       customerName?: string       â”‚  for data)          â”‚   â”‚
â”‚ â”‚       quantityUnit?: string       â”‚                      â”‚   â”‚
â”‚ â”‚       recipes: [                  â”‚                      â”‚   â”‚
â”‚ â”‚         {                         â”‚                      â”‚   â”‚
â”‚ â”‚           recipeId: string        â”‚                      â”‚   â”‚
â”‚ â”‚           quantity: number        â”‚                      â”‚   â”‚
â”‚ â”‚         }                         â”‚                      â”‚   â”‚
â”‚ â”‚       ]                           â”‚                      â”‚   â”‚
â”‚ â”‚     },                            â”‚                      â”‚   â”‚
â”‚ â”‚     targetQuantity: number â—„â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚ â”‚     producedQuantity: number â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤               â”‚   â”‚
â”‚ â”‚   }                               â”‚      â”‚               â”‚   â”‚
â”‚ â”‚ ]                                 â”‚      â”‚               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚      â”‚                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ RECIPES ARRAY                     â”‚      â”‚               â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ [                                 â”‚      â”‚               â”‚   â”‚
â”‚ â”‚   {                               â”‚      â”‚               â”‚   â”‚
â”‚ â”‚     recipeId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚               â”‚   â”‚
â”‚ â”‚     snapshot: {                   â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       recipeNumber?: string       â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       version: number             â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       name: string                â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       description?: string        â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       steps: [                    â”‚      â”‚               â”‚   â”‚
â”‚ â”‚         {                         â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           stepId: string          â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           order: number           â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           name: string            â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           description: string     â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           deviceId: string        â”‚      â”‚               â”‚   â”‚
â”‚ â”‚           ...                     â”‚      â”‚               â”‚   â”‚
â”‚ â”‚         }                         â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       ],                          â”‚      â”‚               â”‚   â”‚
â”‚ â”‚       estimatedDuration: number   â”‚      â”‚               â”‚   â”‚
â”‚ â”‚     },                            â”‚      â”‚               â”‚   â”‚
â”‚ â”‚     targetQuantity: number â—„â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤               â”‚   â”‚
â”‚ â”‚     producedQuantity: number â—„â”€â”€â”€â”€â”˜      â”‚               â”‚   â”‚
â”‚ â”‚   }                                      â”‚               â”‚   â”‚
â”‚ â”‚ ]                                        â”‚               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            â”‚                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ PROGRESS CALCULATION (Pre-save Hook)     â”‚               â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚                                          â”‚               â”‚   â”‚
â”‚ â”‚  totalProduced = Î£ products.produced â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚ â”‚                + Î£ recipes.produced                      â”‚   â”‚
â”‚ â”‚                                                           â”‚   â”‚
â”‚ â”‚  totalTarget = Î£ products.target                         â”‚   â”‚
â”‚ â”‚              + Î£ recipes.target                          â”‚   â”‚
â”‚ â”‚                                                           â”‚   â”‚
â”‚ â”‚  progress = (totalProduced / totalTarget) Ã— 100          â”‚   â”‚
â”‚ â”‚                                                           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Product   â”‚          â”‚   Recipe    â”‚
â”‚  (Master)   â”‚          â”‚  (Master)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚ Can be updated         â”‚ Can be updated
       â”‚ freely                 â”‚ freely
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PROJECT                     â”‚
â”‚  (Contains immutable snapshots)      â”‚
â”‚                                       â”‚
â”‚  â€¢ Product snapshots frozen           â”‚
â”‚  â€¢ Recipe snapshots frozen            â”‚
â”‚  â€¢ Only quantities can change         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ One-to-Many
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Task     â”‚
â”‚             â”‚
â”‚ â€¢ projectId â”‚
â”‚ â€¢ recipeId  â”‚â”€â”€â”€â”€â” References recipe in
â”‚ â€¢ productId â”‚    â”‚ project snapshot
â”‚ â€¢ stepId    â”‚â”€â”€â”€â”€â”˜ Step exists in snapshot
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Cascade Protection

```
DELETE Product/Recipe Attempt
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check if used in      â”‚
â”‚  ANY project?          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚       â”‚
   YES     NO
    â”‚       â”‚
    â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ 400  â”‚  â”‚ 200  â”‚
â”‚Error â”‚  â”‚ OK   â”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Example

```
1. CREATE PROJECT
   â””â”€â†’ Fetch Product from DB
       â””â”€â†’ Create Product Snapshot
           â””â”€â†’ Store in Project.products[]

   â””â”€â†’ Fetch Recipe from DB
       â””â”€â†’ Create Recipe Snapshot
           â””â”€â†’ Store in Project.recipes[]

   â””â”€â†’ Calculate Progress (0%)
       â””â”€â†’ Save Project

2. TASK COMPLETION
   â””â”€â†’ Task completes recipe step
       â””â”€â†’ Is last step?
           â”œâ”€â†’ YES: Increment producedQuantity
           â”‚        â””â”€â†’ Save Project
           â”‚             â””â”€â†’ Progress auto-recalculates
           â”‚
           â””â”€â†’ NO: Create next task
                   â””â”€â†’ Use snapshot steps

3. UPDATE MASTER RECIPE
   â””â”€â†’ Recipe v1 â†’ Recipe v2
       â””â”€â†’ Active projects still use v1 snapshot âœ“
       â””â”€â†’ New projects will get v2 snapshot âœ“
```

## ğŸ¯ Key Design Decisions

### âœ… **Snapshot at Creation**

- **Why:** Immutability, audit trail, worker clarity
- **When:** Project creation only
- **What:** Full product/recipe details including all recipe steps

### âœ… **Reference + Snapshot**

- **Reference:** For linking and cascade checks
- **Snapshot:** For actual data used in project

### âœ… **Equal Weight Progress**

- **Why:** Simplicity
- **Formula:** All products and recipes weighted equally
- **Auto-calculated:** On every save

### âœ… **Cascade Prevention**

- **Scope:** ANY project (active, completed, cancelled)
- **Why:** Historical integrity and compliance
- **Result:** Must archive/delete projects before deleting product/recipe

---

**Created:** October 25, 2025
